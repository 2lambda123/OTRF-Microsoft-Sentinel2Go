# OMIGOD Research Lab Environment

[![Deploy to Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FOTRF%2FAzure-Sentinel2Go%2Fmaster%2Fgrocery-list%2FLinux%2Fdemos%2FCVE-2021-38647-OMIGOD%2Fazuredeploy.json)

## Grocery Items

* Azure Sentinel
    * Would you like to Bring-Your-Own Azure Sentinel?.
    * If so, set the `workspaceId` and `workspaceKey` parameters of your own workspace.
* Linux VMs
    * `Ubuntu`
    * `Centos` [OPTIONAL]
    * `Red hat` [OPTIONAL]
* [OMS Agent for Linux](https://github.com/microsoft/OMS-Agent-for-Linux) installed
    * It connects to the Microsoft Log Analytics workspace defined in the template.
    * We force it to install `OMI` version `1.6.8.0`
* Syslog Data Connector enabled
* Linux Syslog Facilities collected
    * `auth`
    * `authpriv`
    * `cron`
    * `daemon`
    * `ftp`
    * `kern`
    * `user`
* [OMS Auditd Plugin installed (MSTIC-Research branch)](https://github.com/microsoft/OMS-Auditd-Plugin/tree/MSTIC-Research)

## Validate Environment

ssh to boxes deployed and confirm:
* Version of OMI is at `1.6.8.0`
* Ports 5986 and 5985 are open
* Test a [basic POC](https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure)

![](../../../../resources/images/lab_environment_omigod.png)

## Additional Telemetry - SCX Verbose Logging

Set logging with the following commands:

```
/opt/microsoft/scx/bin/tools/scxadmin -log-set all verbose
```

Explore messages

```
tail -f /var/opt/microsoft/scx/log/scx.log
```

![](../../../../resources/images/oms_scx_verbose_logging.png)

Set all logging back to `INFO`

```
/opt/microsoft/scx/bin/tools/scxadmin -log-set all intermediate
```
